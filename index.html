<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Schulte Table</title>

    <style>
        * {
            font-size: 25px;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
        }
        td {
            text-align: center;
        }
        td.schulte-choose {
           cursor: pointer;
        }
        td.schulte-choose-success {
            background-color: forestgreen;
        }
    </style>

    <script src="jquery-2.1.3.js"></script>
    <script src="underscore.js"></script>
    <script src="backbone.js"></script>
    <script>
        /**
         * TODO: circle
         */
        $(document).ready(function() {

            var SchulteCellView = Backbone.View.extend({
                tagName: "td",
                className: "schulte-choose",

                initialize: function(id, value) {
                    this.$el.attr("id", id).html(value);
                },

                render: function() {
                    return this.$el;
                }
            });

            var SchulteTableView =  Backbone.View.extend({
                el: "#js-schulte",

                matrix: {},

                initialize: function(size) {
                    this.render(size);
                },

                render: function(size) {
                    this.$el.html(this.getFilledTable(size));
                },

                getItemId: function(y, x) {
                    return "js-item" + y + "-" + x;
                },

                getChoose: function(y, x) {
                    return new SchulteCellView(this.getItemId(y, x), this.matrix[y][x]);
                },

                getTable: function(size) {
                    var $table = $("<table>");

                    for (var y = 1; y <= size; y++) {
                        var $tr = $("<tr>");

                        for (var x = 1; x <= size; x++) {
                            $tr.append(this.getChoose(y, x).render());
                        }

                        $table.append($tr);
                    }

                    return $table;
                },

                getShuffleMap: function(size) {
                    var map = {};
                    var index = 0;

                    var values = _.shuffle(_.range(size * size));

                    for (var y = 1; y <= size; y++) {
                        var row = {};
                        for (var x = 1; x <= size; x++) {
                            row[x] = values[index++] + 1;
                        }
                        map[y] = row;
                    }

                    return map;
                },

                schulteChooseEvent: function($table) {
                    var currentChoose = 1;

                    $table.find("td").click(function() {
                        var $self = $(this);

                        if ($self.html() == currentChoose) {
                            currentChoose++;

                            $self.addClass("schulte-choose-success");
                        }
                    });
                },

                getFilledTable: function(size) {
                    this.matrix = this.getShuffleMap(size);

                    var $table = this.getTable(size);

                    this.schulteChooseEvent($table);

                    return $table;
                }
            });

            var size = 5;

            function resetSchulteTable() {
                new SchulteTableView(size);
            };

            resetSchulteTable();

            setInterval(resetSchulteTable, 45 * 100);
        });
    </script>
</head>
<body>
    <div id="js-schulte" align="center"></div>
</body>
</html>