<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Schulte Table</title>

    <style>
        * {
            font-size: 25px;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
        }
        td {
            text-align: center;
        }
        td.schulte-choose {
           cursor: pointer;
        }
        td.schulte-choose-success {
            background-color: forestgreen;
        }
    </style>

    <script src="jquery-2.1.3.js"></script>
    <script src="underscore.js"></script>
    <script src="backbone.js"></script>
    <script>
        /**
         * TODO: circle
         */
        $(document).ready(function() {

            var SchulteCellView = Backbone.View.extend({
                tagName: "td",
                className: "schulte-choose",

                render: function(value) {
                    return this.$el.html(value);
                }
            });

            var SchulteTableView =  Backbone.View.extend({
                el: "#js-schulte",

                initialize: function(size) {
                    this.render(size);
                },

                render: function(size) {
                    this.$el.html(this.getFilledTable(size));
                },

                getFilledTable: function(size) {
                    var $table = $("<table>");

                    var event = this.getChooseEvent();

                    var generator = (function() {
                        var values = _.shuffle(_.range(size * size)),
                            index = 0;

                        return function() {
                            return values[index++] + 1;
                        };
                    })();

                    for (var y = 1; y <= size; y++) {
                        var $tr = $("<tr>");

                        for (var x = 1; x <= size; x++) {
                            var cell = new SchulteCellView();

                            $tr.append(cell.render(generator).click(event));
                        }

                        $table.append($tr);
                    }

                    return $table;
                },

                getChooseEvent: function() {
                    var currentChoose = 1;

                    return function() {
                        var $self = $(this);

                        if ($self.html() == currentChoose) {
                            currentChoose++;

                            $self.addClass("schulte-choose-success");
                        }
                    };
                }
            });

            var size = 5;

            function resetSchulteTable() {
                new SchulteTableView(size);
            };

            resetSchulteTable();

            setInterval(resetSchulteTable, 45 * 100);
        });
    </script>
</head>
<body>
    <div id="js-schulte" align="center"></div>
</body>
</html>